name: Bump app submodule pointers (PR)

on:
  push:
    branches: ["main", "develop"]

jobs:
  bump:
    runs-on: ubuntu-latest
    strategy:
      matrix:
        app_repo: ["Ricreo-print-farm", "Ricreo-Inventory"]

    env:
      OWNER: Vladricreo
      SCHEMA_URL: https://github.com/Vladricreo/ricreo-schema.git
      BOT_BRANCH_PREFIX: chore/bump-schema

    steps:
      - name: Checkout schema (for SHA)
        uses: actions/checkout@v4

      - name: Install gh
        run: |
          type -p gh >/dev/null || (sudo apt-get update && sudo apt-get install -y gh)

      - name: Decide target branch
        id: target
        run: |
          # se pushi su main -> target main
          # se pushi su develop -> target develop
          echo "target_branch=${GITHUB_REF_NAME}" >> $GITHUB_OUTPUT

      - name: Clone app repo
        env:
          TOKEN: ${{ secrets.SYNC_TOKEN }}
        run: |
          git clone https://x-access-token:${TOKEN}@github.com/${OWNER}/${{ matrix.app_repo }}.git app

      - name: Prepare bump branch and update submodule pointer
        env:
